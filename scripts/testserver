#!/usr/bin/env python
"""
This is a deejayd test server executable
"""

import sys

print sys.path

from deejayd.net.deejaydProtocol import DeejaydFactory
from deejayd.mediadb.database import sqliteDatabase
from deejayd.mediadb.deejaydDB import DeejaydDB
from twisted.internet import reactor

# argv[1] should be port
# argv[2] should be music dir
# argv[3] should be db filename
if len(sys.argv) != 4:
    sys.exit('Incorrect invocation')

port = sys.argv[1]
musicDir = sys.argv[2]
dbfilename = sys.argv[3]

db = sqliteDatabase(dbfilename)

ddb = DeejaydDB(db, musicDir)
ddb.updateDir('.')

factory = DeejaydFactory(ddb)
reactor.listenTCP(int(port), factory)

def printReady():
    sys.stderr.write('ready\n')

reactor.addSystemEventTrigger('after', 'startup', printReady)

reactor.run()

# vim: ts=4 sw=4 expandtab
